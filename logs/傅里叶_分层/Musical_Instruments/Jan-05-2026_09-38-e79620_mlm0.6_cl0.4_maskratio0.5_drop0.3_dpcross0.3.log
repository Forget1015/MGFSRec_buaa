Mon 05 Jan 2026 09:38:47 INFO  {'seed': 2020, 'dataset': 'Musical_Instruments', 'bidirectional': False, 'n_heads': 4, 'lr': 0.001, 'tau': 0.07, 'cl_weight': 0.4, 'mlm_weight': 0.6, 'neg_num': 24000, 'text_types': ['title', 'brand', 'features', 'categories', 'description'], 'epochs': 500, 'batch_size': 100, 'num_workers': 8, 'eval_step': 1, 'learner': 'AdamW', 'data_path': './dataset', 'map_path': '.emb_map.json', 'text_index_path': '.code.pq.20_256.pca128.title_brand_features_categories_description.json', 'text_emb_path': '.t5.meta.emb.npy', 'lr_scheduler_type': 'constant', 'gradient_accumulation_steps': 1, 'warmup_steps': 500, 'weight_decay': 0.0001, 'max_his_len': 50, 'n_codes_per_lel': 256, 'code_level': 20, 'early_stop': 100, 'embedding_size': 128, 'hidden_size': 512, 'n_layers': 2, 'n_layers_cross': 2, 'dropout_prob': 0.3, 'dropout_prob_cross': 0.3, 'mask_ratio': 0.5, 'device': 'cuda:1', 'metrics': 'recall@5,ndcg@5,recall@10,ndcg@10', 'valid_metric': 'ndcg@10', 'log_dir': './logs/傅里叶_分层', 'ckpt_dir': './myckpt/', 'resume': '/home/yejinxuan/yejinxuan/CCFRec/myckpt/Musical_Instruments/Jan-04-2026_02-44-197013_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth', 'run_local_time': 'Jan-05-2026_09-38', 'save_file_name': 'Jan-05-2026_09-38-e79620_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3'}
Mon 05 Jan 2026 09:39:18 INFO  Resumed from checkpoint: /home/yejinxuan/yejinxuan/CCFRec/myckpt/Musical_Instruments/Jan-04-2026_02-44-197013_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth, starting from epoch 26
Mon 05 Jan 2026 09:39:18 INFO  CCFRec(
  (query_code_embedding): Embedding(5121, 128, padding_idx=0)
  (item_text_embedding): ModuleList(
    (0-4): 5 x Embedding(24588, 128, padding_idx=0)
  )
  (qformer): CrossAttTransformer(
    (layer): ModuleList(
      (0-1): 2 x CrossAttTransformerLayer(
        (self_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.3, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.3, inplace=False)
        )
        (cross_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.3, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.3, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.3, inplace=False)
        )
      )
    )
  )
  (fourier_attention): FrequencyAttention(
    (freq_proj): Linear(in_features=128, out_features=128, bias=True)
    (dropout): Dropout(p=0.1, inplace=False)
    (layer_norm): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
  )
  (intra_position_embedding): Embedding(50, 128)
  (intra_transformer): Transformer(
    (layer): ModuleList(
      (0-1): 2 x TransformerLayer(
        (multi_head_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.3, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.3, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.3, inplace=False)
        )
      )
    )
  )
  (intra_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (intra_dropout): Dropout(p=0.3, inplace=False)
  (inter_lstm): LSTM(128, 64, batch_first=True, bidirectional=True)
  (inter_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (inter_dropout): Dropout(p=0.3, inplace=False)
  (session_position_embedding): Embedding(50, 128)
  (session_attention_w): Linear(in_features=256, out_features=128, bias=True)
  (session_attention_v): Linear(in_features=128, out_features=1, bias=False)
  (residual_gate): Sequential(
    (0): Linear(in_features=256, out_features=128, bias=True)
    (1): Sigmoid()
  )
  (loss_fct): CrossEntropyLoss()
)
Mon 05 Jan 2026 10:17:35 INFO  [Epoch 26] training [time: 2296.86s, loss: 10.7600, mlm_loss: 4.2599, rec_loss: 8.1422, cl_loss: 0.1546, ]
Mon 05 Jan 2026 10:19:13 INFO  [Epoch 26] Val Result: {'recall@5': 0.04256689705600724, 'ndcg@5': 0.027440140475390666, 'recall@10': 0.0688034262434931, 'ndcg@10': 0.03587063103014053}
Mon 05 Jan 2026 10:56:46 INFO  [Epoch 27] training [time: 2253.44s, loss: 10.7546, mlm_loss: 4.2578, rec_loss: 8.1381, cl_loss: 0.1546, ]
Mon 05 Jan 2026 10:58:23 INFO  [Epoch 27] Val Result: {'recall@5': 0.04402931805915841, 'ndcg@5': 0.02816997253070247, 'recall@10': 0.06965650516199795, 'ndcg@10': 0.03639085531923776}
Mon 05 Jan 2026 11:36:07 INFO  [Epoch 28] training [time: 2264.68s, loss: 10.7488, mlm_loss: 4.2552, rec_loss: 8.1342, cl_loss: 0.1536, ]
Mon 05 Jan 2026 11:37:43 INFO  [Epoch 28] Val Result: {'recall@5': 0.043071780497571335, 'ndcg@5': 0.02766054566103813, 'recall@10': 0.06923867058966904, 'ndcg@10': 0.03604250581650231}
Mon 05 Jan 2026 12:15:37 INFO  [Epoch 29] training [time: 2273.72s, loss: 10.7423, mlm_loss: 4.2536, rec_loss: 8.1283, cl_loss: 0.1546, ]
Mon 05 Jan 2026 12:17:14 INFO  [Epoch 29] Val Result: {'recall@5': 0.04294991208064207, 'ndcg@5': 0.027537909497183495, 'recall@10': 0.0700047006389387, 'ndcg@10': 0.036244159535417465}
Mon 05 Jan 2026 12:54:58 INFO  [Epoch 30] training [time: 2263.11s, loss: 10.7350, mlm_loss: 4.2512, rec_loss: 8.1225, cl_loss: 0.1545, ]
Mon 05 Jan 2026 12:56:31 INFO  [Epoch 30] Val Result: {'recall@5': 0.04272358502063058, 'ndcg@5': 0.02728416329452189, 'recall@10': 0.06993506154355054, 'ndcg@10': 0.03606562250238161}
Mon 05 Jan 2026 13:34:18 INFO  [Epoch 31] training [time: 2266.15s, loss: 10.7315, mlm_loss: 4.2489, rec_loss: 8.1205, cl_loss: 0.1540, ]
Mon 05 Jan 2026 13:35:58 INFO  [Epoch 31] Val Result: {'recall@5': 0.04340256620066505, 'ndcg@5': 0.027814484727600786, 'recall@10': 0.06948240742352757, 'ndcg@10': 0.03620493181025049}
Mon 05 Jan 2026 14:13:39 INFO  [Epoch 32] training [time: 2260.65s, loss: 10.7228, mlm_loss: 4.2461, rec_loss: 8.1137, cl_loss: 0.1537, ]
Mon 05 Jan 2026 14:15:15 INFO  [Epoch 32] Val Result: {'recall@5': 0.04341997597451209, 'ndcg@5': 0.02783907524388253, 'recall@10': 0.07061404272358503, 'ndcg@10': 0.036553034394059554}
Mon 05 Jan 2026 14:53:01 INFO  [Epoch 33] training [time: 2265.88s, loss: 10.7189, mlm_loss: 4.2456, rec_loss: 8.1101, cl_loss: 0.1535, ]
Mon 05 Jan 2026 14:54:40 INFO  [Epoch 33] Val Result: {'recall@5': 0.04338515642681801, 'ndcg@5': 0.027909664704869844, 'recall@10': 0.06995247131739758, 'ndcg@10': 0.03644044953519607}
Mon 05 Jan 2026 15:32:37 INFO  [Epoch 34] training [time: 2277.04s, loss: 10.7150, mlm_loss: 4.2450, rec_loss: 8.1062, cl_loss: 0.1546, ]
Mon 05 Jan 2026 15:34:11 INFO  [Epoch 34] Val Result: {'recall@5': 0.04328069778373579, 'ndcg@5': 0.02785546898729786, 'recall@10': 0.06916903149428089, 'ndcg@10': 0.036182430402575794}
Mon 05 Jan 2026 16:11:54 INFO  [Epoch 35] training [time: 2262.78s, loss: 10.7101, mlm_loss: 4.2428, rec_loss: 8.1028, cl_loss: 0.1540, ]
Mon 05 Jan 2026 16:13:29 INFO  [Epoch 35] Val Result: {'recall@5': 0.043454795522206165, 'ndcg@5': 0.027793539626474788, 'recall@10': 0.07049217430665576, 'ndcg@10': 0.03650006523203137}
Mon 05 Jan 2026 16:51:09 INFO  [Epoch 36] training [time: 2259.51s, loss: 10.7041, mlm_loss: 4.2403, rec_loss: 8.0983, cl_loss: 0.1540, ]
Mon 05 Jan 2026 16:52:45 INFO  [Epoch 36] Saving current: ./myckpt/Musical_Instruments/Jan-05-2026_09-38-e79620_mlm0.6_cl0.4_maskratio0.5_drop0.3_dpcross0.3/best_model.pth
Mon 05 Jan 2026 16:52:45 INFO  [Epoch 36] Val Result: {'recall@5': 0.044377513536099165, 'ndcg@5': 0.02862971413890769, 'recall@10': 0.07040512543742057, 'ndcg@10': 0.03700671771400791}
Mon 05 Jan 2026 17:30:34 INFO  [Epoch 37] training [time: 2269.23s, loss: 10.7031, mlm_loss: 4.2408, rec_loss: 8.0967, cl_loss: 0.1549, ]
Mon 05 Jan 2026 17:32:08 INFO  [Epoch 37] Val Result: {'recall@5': 0.042236111352913525, 'ndcg@5': 0.026986134414123782, 'recall@10': 0.06849005031424642, 'ndcg@10': 0.03542474568897777}
Mon 05 Jan 2026 18:10:05 INFO  [Epoch 38] training [time: 2276.52s, loss: 10.6957, mlm_loss: 4.2396, rec_loss: 8.0905, cl_loss: 0.1539, ]
Mon 05 Jan 2026 18:11:40 INFO  [Epoch 38] Val Result: {'recall@5': 0.0442556451191699, 'ndcg@5': 0.027954287326971604, 'recall@10': 0.07122338480823134, 'ndcg@10': 0.03661575933249395}
Mon 05 Jan 2026 18:49:22 INFO  [Epoch 39] training [time: 2261.84s, loss: 10.6950, mlm_loss: 4.2387, rec_loss: 8.0897, cl_loss: 0.1552, ]
Mon 05 Jan 2026 18:51:02 INFO  [Epoch 39] Val Result: {'recall@5': 0.04389003986838211, 'ndcg@5': 0.028179841072779058, 'recall@10': 0.07073591114051428, 'ndcg@10': 0.0367958205178014}
Mon 05 Jan 2026 19:28:34 INFO  [Epoch 40] training [time: 2252.70s, loss: 10.6895, mlm_loss: 4.2375, rec_loss: 8.0854, cl_loss: 0.1541, ]
Mon 05 Jan 2026 19:30:15 INFO  [Epoch 40] Val Result: {'recall@5': 0.0422709309006076, 'ndcg@5': 0.02721001514288274, 'recall@10': 0.07007433973432685, 'ndcg@10': 0.03614639258539945}
Mon 05 Jan 2026 20:08:30 INFO  [Epoch 41] training [time: 2294.51s, loss: 10.6871, mlm_loss: 4.2372, rec_loss: 8.0831, cl_loss: 0.1539, ]
Mon 05 Jan 2026 20:10:04 INFO  [Epoch 41] Val Result: {'recall@5': 0.04237538954368983, 'ndcg@5': 0.026999671257385442, 'recall@10': 0.06847264054039938, 'ndcg@10': 0.035407854819746495}
Mon 05 Jan 2026 20:47:36 INFO  [Epoch 42] training [time: 2251.40s, loss: 10.6826, mlm_loss: 4.2366, rec_loss: 8.0791, cl_loss: 0.1538, ]
Mon 05 Jan 2026 20:49:11 INFO  [Epoch 42] Val Result: {'recall@5': 0.04355925416528839, 'ndcg@5': 0.02774322759009526, 'recall@10': 0.06934312923275127, 'ndcg@10': 0.0360355027003504}
Mon 05 Jan 2026 21:27:23 INFO  [Epoch 43] training [time: 2292.13s, loss: 10.6795, mlm_loss: 4.2346, rec_loss: 8.0765, cl_loss: 0.1554, ]
Mon 05 Jan 2026 21:29:01 INFO  [Epoch 43] Val Result: {'recall@5': 0.0434722052960532, 'ndcg@5': 0.027901681460229116, 'recall@10': 0.06965650516199795, 'ndcg@10': 0.036322114342121}
Mon 05 Jan 2026 22:06:29 INFO  [Epoch 44] training [time: 2247.40s, loss: 10.6783, mlm_loss: 4.2354, rec_loss: 8.0747, cl_loss: 0.1559, ]
Mon 05 Jan 2026 22:08:04 INFO  [Epoch 44] Val Result: {'recall@5': 0.04171381813750239, 'ndcg@5': 0.026772230862014613, 'recall@10': 0.06934312923275127, 'ndcg@10': 0.03564996162186273}
Mon 05 Jan 2026 22:46:43 INFO  [Epoch 45] training [time: 2319.61s, loss: 10.6733, mlm_loss: 4.2340, rec_loss: 8.0709, cl_loss: 0.1551, ]
Mon 05 Jan 2026 22:48:20 INFO  [Epoch 45] Val Result: {'recall@5': 0.04328069778373579, 'ndcg@5': 0.027546796246295035, 'recall@10': 0.07073591114051428, 'ndcg@10': 0.03636026224404063}
Mon 05 Jan 2026 23:27:02 INFO  [Epoch 46] training [time: 2321.80s, loss: 10.6710, mlm_loss: 4.2347, rec_loss: 8.0678, cl_loss: 0.1561, ]
Mon 05 Jan 2026 23:28:38 INFO  [Epoch 46] Val Result: {'recall@5': 0.04402931805915841, 'ndcg@5': 0.028100563600000687, 'recall@10': 0.07024843747279723, 'ndcg@10': 0.0365246870651636}
Tue 06 Jan 2026 00:07:11 INFO  [Epoch 47] training [time: 2313.08s, loss: 10.6698, mlm_loss: 4.2343, rec_loss: 8.0665, cl_loss: 0.1569, ]
Tue 06 Jan 2026 00:08:47 INFO  [Epoch 47] Val Result: {'recall@5': 0.043994498511464336, 'ndcg@5': 0.0278306678924623, 'recall@10': 0.07052699385434984, 'ndcg@10': 0.036348265465713125}
Tue 06 Jan 2026 00:47:05 INFO  [Epoch 48] training [time: 2298.35s, loss: 10.6683, mlm_loss: 4.2346, rec_loss: 8.0652, cl_loss: 0.1558, ]
Tue 06 Jan 2026 00:48:43 INFO  [Epoch 48] Val Result: {'recall@5': 0.044081547380699526, 'ndcg@5': 0.02818317812088358, 'recall@10': 0.07148453141593691, 'ndcg@10': 0.03697309395083914}
Tue 06 Jan 2026 01:26:54 INFO  [Epoch 49] training [time: 2290.80s, loss: 10.6640, mlm_loss: 4.2341, rec_loss: 8.0612, cl_loss: 0.1559, ]
Tue 06 Jan 2026 01:28:28 INFO  [Epoch 49] Val Result: {'recall@5': 0.04341997597451209, 'ndcg@5': 0.02758794382545833, 'recall@10': 0.07061404272358503, 'ndcg@10': 0.03631449597889559}
Tue 06 Jan 2026 02:06:19 INFO  [Epoch 50] training [time: 2270.82s, loss: 10.6633, mlm_loss: 4.2350, rec_loss: 8.0596, cl_loss: 0.1568, ]
Tue 06 Jan 2026 02:07:56 INFO  [Epoch 50] Val Result: {'recall@5': 0.04341997597451209, 'ndcg@5': 0.027696237847753512, 'recall@10': 0.06911680217273977, 'ndcg@10': 0.0359408483686183}
Tue 06 Jan 2026 02:46:37 INFO  [Epoch 51] training [time: 2321.14s, loss: 10.6600, mlm_loss: 4.2342, rec_loss: 8.0567, cl_loss: 0.1568, ]
Tue 06 Jan 2026 02:48:16 INFO  [Epoch 51] Val Result: {'recall@5': 0.043715942129911735, 'ndcg@5': 0.027901952814475977, 'recall@10': 0.07002211041278573, 'ndcg@10': 0.03634377072354263}
Tue 06 Jan 2026 03:26:43 INFO  [Epoch 52] training [time: 2306.43s, loss: 10.6641, mlm_loss: 4.2335, rec_loss: 8.0614, cl_loss: 0.1565, ]
Tue 06 Jan 2026 03:28:19 INFO  [Epoch 52] Val Result: {'recall@5': 0.04289768275910096, 'ndcg@5': 0.027307425366277498, 'recall@10': 0.06988283222200943, 'ndcg@10': 0.03598813078793608}
Tue 06 Jan 2026 04:06:58 INFO  [Epoch 53] training [time: 2318.99s, loss: 10.6598, mlm_loss: 4.2336, rec_loss: 8.0571, cl_loss: 0.1564, ]
Tue 06 Jan 2026 04:08:35 INFO  [Epoch 53] Val Result: {'recall@5': 0.042514667734466126, 'ndcg@5': 0.02719233046843752, 'recall@10': 0.06983060290046832, 'ndcg@10': 0.0359489812355594}
Tue 06 Jan 2026 04:46:20 INFO  [Epoch 54] training [time: 2264.78s, loss: 10.6604, mlm_loss: 4.2341, rec_loss: 8.0571, cl_loss: 0.1569, ]
Tue 06 Jan 2026 04:47:55 INFO  [Epoch 54] Val Result: {'recall@5': 0.04352443461759432, 'ndcg@5': 0.027774005348995913, 'recall@10': 0.07031807656818538, 'ndcg@10': 0.036391255698929356}
