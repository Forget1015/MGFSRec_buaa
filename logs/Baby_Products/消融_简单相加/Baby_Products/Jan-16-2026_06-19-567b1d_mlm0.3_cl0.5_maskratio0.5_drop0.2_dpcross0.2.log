Fri 16 Jan 2026 06:19:28 INFO  {'seed': 2020, 'dataset': 'Baby_Products', 'bidirectional': False, 'n_heads': 2, 'lr': 0.0005, 'tau': 0.07, 'cl_weight': 0.5, 'mlm_weight': 0.3, 'neg_num': 25000, 'text_types': ['title', 'brand', 'features', 'categories', 'description'], 'epochs': 500, 'batch_size': 100, 'num_workers': 8, 'eval_step': 1, 'learner': 'AdamW', 'data_path': './dataset', 'map_path': '.emb_map.json', 'text_index_path': '.code.pq.20_256.pca128.title_brand_features_categories_description.json', 'text_emb_path': '.t5.meta.emb.npy', 'lr_scheduler_type': 'constant', 'gradient_accumulation_steps': 1, 'warmup_steps': 500, 'weight_decay': 0.0001, 'max_his_len': 50, 'n_codes_per_lel': 256, 'code_level': 20, 'early_stop': 100, 'embedding_size': 128, 'hidden_size': 512, 'n_layers': 2, 'n_layers_cross': 2, 'dropout_prob': 0.2, 'dropout_prob_cross': 0.2, 'mask_ratio': 0.5, 'device': 'cuda:0', 'metrics': 'recall@5,ndcg@5,recall@10,ndcg@10', 'valid_metric': 'ndcg@10', 'log_dir': './logs/Baby_Products/消融_简单相加', 'ckpt_dir': './myckpt/', 'resume': None, 'run_local_time': 'Jan-16-2026_06-19', 'save_file_name': 'Jan-16-2026_06-19-567b1d_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2'}
Fri 16 Jan 2026 06:20:33 INFO  CCFRec(
  (query_code_embedding): Embedding(5121, 128, padding_idx=0)
  (item_text_embedding): ModuleList(
    (0-4): 5 x Embedding(36014, 128, padding_idx=0)
  )
  (qformer): CrossAttTransformer(
    (layer): ModuleList(
      (0-1): 2 x CrossAttTransformerLayer(
        (self_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.2, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.2, inplace=False)
        )
        (cross_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.2, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.2, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.2, inplace=False)
        )
      )
    )
  )
  (intra_position_embedding): Embedding(50, 128)
  (intra_transformer): Transformer(
    (layer): ModuleList(
      (0-1): 2 x TransformerLayer(
        (multi_head_attention): MultiHeadAttention(
          (query): Linear(in_features=128, out_features=128, bias=True)
          (key): Linear(in_features=128, out_features=128, bias=True)
          (value): Linear(in_features=128, out_features=128, bias=True)
          (softmax): Softmax(dim=-1)
          (attn_dropout): Dropout(p=0.2, inplace=False)
          (out_linear): Linear(in_features=128, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (out_dropout): Dropout(p=0.2, inplace=False)
        )
        (feed_forward): FeedForward(
          (linear_1): Linear(in_features=128, out_features=512, bias=True)
          (linear_2): Linear(in_features=512, out_features=128, bias=True)
          (LayerNorm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.2, inplace=False)
        )
      )
    )
  )
  (intra_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (intra_dropout): Dropout(p=0.2, inplace=False)
  (inter_lstm): LSTM(128, 64, batch_first=True, bidirectional=True)
  (inter_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (inter_dropout): Dropout(p=0.2, inplace=False)
  (session_position_embedding): Embedding(50, 128)
  (session_attention_w): Linear(in_features=256, out_features=128, bias=True)
  (session_attention_v): Linear(in_features=128, out_features=1, bias=False)
  (output_layer_norm): LayerNorm((128,), eps=1e-12, elementwise_affine=True)
  (loss_fct): CrossEntropyLoss()
)
Fri 16 Jan 2026 07:40:37 INFO  [Epoch 0] training [time: 4804.59s, loss: 10.7116, mlm_loss: 5.5409, rec_loss: 8.9332, cl_loss: 0.2322, ]
Fri 16 Jan 2026 07:45:15 INFO  [Epoch 0] Saving current: ./myckpt/Baby_Products/Jan-16-2026_06-19-567b1d_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Fri 16 Jan 2026 07:45:15 INFO  [Epoch 0] Val Result: {'recall@5': 0.02364418976369075, 'ndcg@5': 0.015369649522890884, 'recall@10': 0.03840108239320321, 'ndcg@10': 0.020101555026575246}
Fri 16 Jan 2026 09:04:44 INFO  [Epoch 1] training [time: 4768.35s, loss: 9.9867, mlm_loss: 4.7259, rec_loss: 8.5221, cl_loss: 0.0938, ]
Fri 16 Jan 2026 09:09:20 INFO  [Epoch 1] Saving current: ./myckpt/Baby_Products/Jan-16-2026_06-19-567b1d_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Fri 16 Jan 2026 09:09:20 INFO  [Epoch 1] Val Result: {'recall@5': 0.02485790273052256, 'ndcg@5': 0.015919438033371588, 'recall@10': 0.04049026045086452, 'ndcg@10': 0.020941084510197192}
Fri 16 Jan 2026 10:28:22 INFO  [Epoch 2] training [time: 4742.42s, loss: 9.8258, mlm_loss: 4.5929, rec_loss: 8.4057, cl_loss: 0.0846, ]
Fri 16 Jan 2026 10:33:00 INFO  [Epoch 2] Saving current: ./myckpt/Baby_Products/Jan-16-2026_06-19-567b1d_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Fri 16 Jan 2026 10:33:00 INFO  [Epoch 2] Val Result: {'recall@5': 0.026900654609124733, 'ndcg@5': 0.017188202307420145, 'recall@10': 0.04370693142853353, 'ndcg@10': 0.022601497605825173}
Fri 16 Jan 2026 11:52:29 INFO  [Epoch 3] training [time: 4769.91s, loss: 9.7277, mlm_loss: 4.5079, rec_loss: 8.3353, cl_loss: 0.0800, ]
Fri 16 Jan 2026 11:57:05 INFO  [Epoch 3] Saving current: ./myckpt/Baby_Products/Jan-16-2026_06-19-567b1d_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Fri 16 Jan 2026 11:57:05 INFO  [Epoch 3] Val Result: {'recall@5': 0.02791539823713166, 'ndcg@5': 0.017882160715966787, 'recall@10': 0.045245627648779325, 'ndcg@10': 0.023437945896324128}
Fri 16 Jan 2026 13:16:24 INFO  [Epoch 4] training [time: 4759.44s, loss: 9.6596, mlm_loss: 4.4502, rec_loss: 8.2854, cl_loss: 0.0784, ]
Fri 16 Jan 2026 13:21:03 INFO  [Epoch 4] Saving current: ./myckpt/Baby_Products/Jan-16-2026_06-19-567b1d_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Fri 16 Jan 2026 13:21:03 INFO  [Epoch 4] Val Result: {'recall@5': 0.028485777008429667, 'ndcg@5': 0.018328163602810598, 'recall@10': 0.04535837694078009, 'ndcg@10': 0.02373628634651977}
Fri 16 Jan 2026 14:40:20 INFO  [Epoch 5] training [time: 4756.20s, loss: 9.6064, mlm_loss: 4.4076, rec_loss: 8.2456, cl_loss: 0.0770, ]
Fri 16 Jan 2026 14:44:58 INFO  [Epoch 5] Saving current: ./myckpt/Baby_Products/Jan-16-2026_06-19-567b1d_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Fri 16 Jan 2026 14:44:58 INFO  [Epoch 5] Val Result: {'recall@5': 0.029003097289374374, 'ndcg@5': 0.018599558566967753, 'recall@10': 0.04657872221890607, 'ndcg@10': 0.024237312124237798}
Fri 16 Jan 2026 16:03:51 INFO  [Epoch 6] training [time: 4732.39s, loss: 9.5664, mlm_loss: 4.3759, rec_loss: 8.2158, cl_loss: 0.0758, ]
Fri 16 Jan 2026 16:08:31 INFO  [Epoch 6] Saving current: ./myckpt/Baby_Products/Jan-16-2026_06-19-567b1d_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Fri 16 Jan 2026 16:08:31 INFO  [Epoch 6] Val Result: {'recall@5': 0.029341345165376682, 'ndcg@5': 0.018945188501371276, 'recall@10': 0.047261850282204844, 'ndcg@10': 0.024708194795940382}
Fri 16 Jan 2026 17:29:00 INFO  [Epoch 7] training [time: 4829.52s, loss: 9.5329, mlm_loss: 4.3506, rec_loss: 8.1901, cl_loss: 0.0751, ]
Fri 16 Jan 2026 17:33:43 INFO  [Epoch 7] Saving current: ./myckpt/Baby_Products/Jan-16-2026_06-19-567b1d_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Fri 16 Jan 2026 17:33:43 INFO  [Epoch 7] Val Result: {'recall@5': 0.029666328418790664, 'ndcg@5': 0.019089069153031574, 'recall@10': 0.047905184477738644, 'ndcg@10': 0.02493806360627759}
Fri 16 Jan 2026 18:53:36 INFO  [Epoch 8] training [time: 4792.75s, loss: 9.5052, mlm_loss: 4.3302, rec_loss: 8.1689, cl_loss: 0.0746, ]
Fri 16 Jan 2026 18:58:22 INFO  [Epoch 8] Saving current: ./myckpt/Baby_Products/Jan-16-2026_06-19-567b1d_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Fri 16 Jan 2026 18:58:22 INFO  [Epoch 8] Val Result: {'recall@5': 0.030203545633617858, 'ndcg@5': 0.01943327109511526, 'recall@10': 0.048051095326210234, 'ndcg@10': 0.025151740327060693}
Fri 16 Jan 2026 20:17:15 INFO  [Epoch 9] training [time: 4733.24s, loss: 9.4809, mlm_loss: 4.3134, rec_loss: 8.1498, cl_loss: 0.0742, ]
Fri 16 Jan 2026 20:21:57 INFO  [Epoch 9] Saving current: ./myckpt/Baby_Products/Jan-16-2026_06-19-567b1d_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Fri 16 Jan 2026 20:21:57 INFO  [Epoch 9] Val Result: {'recall@5': 0.030190281011029534, 'ndcg@5': 0.019426966847940905, 'recall@10': 0.04826332928762345, 'ndcg@10': 0.02523513278582184}
Fri 16 Jan 2026 21:42:37 INFO  [Epoch 10] training [time: 4840.00s, loss: 9.4595, mlm_loss: 4.2997, rec_loss: 8.1324, cl_loss: 0.0743, ]
Fri 16 Jan 2026 21:47:21 INFO  [Epoch 10] Saving current: ./myckpt/Baby_Products/Jan-16-2026_06-19-567b1d_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Fri 16 Jan 2026 21:47:21 INFO  [Epoch 10] Val Result: {'recall@5': 0.03063464586773845, 'ndcg@5': 0.01972140916100956, 'recall@10': 0.048727591078214845, 'ndcg@10': 0.02553123556304244}
Fri 16 Jan 2026 23:07:44 INFO  [Epoch 11] training [time: 4822.52s, loss: 9.4403, mlm_loss: 4.2877, rec_loss: 8.1170, cl_loss: 0.0741, ]
Fri 16 Jan 2026 23:12:27 INFO  [Epoch 11] Val Result: {'recall@5': 0.029852033135027226, 'ndcg@5': 0.01928589711839044, 'recall@10': 0.04771284745020792, 'ndcg@10': 0.025013523628542235}
Sat 17 Jan 2026 00:33:14 INFO  [Epoch 12] training [time: 4846.75s, loss: 9.4245, mlm_loss: 4.2772, rec_loss: 8.1046, cl_loss: 0.0736, ]
Sat 17 Jan 2026 00:37:57 INFO  [Epoch 12] Saving current: ./myckpt/Baby_Products/Jan-16-2026_06-19-567b1d_mlm0.3_cl0.5_maskratio0.5_drop0.2_dpcross0.2/best_model.pth
Sat 17 Jan 2026 00:37:57 INFO  [Epoch 12] Val Result: {'recall@5': 0.030952996809858267, 'ndcg@5': 0.019930245865607082, 'recall@10': 0.04899951584127553, 'ndcg@10': 0.02571409090729706}
Sat 17 Jan 2026 01:57:34 INFO  [Epoch 13] training [time: 4776.97s, loss: 9.4093, mlm_loss: 4.2675, rec_loss: 8.0922, cl_loss: 0.0736, ]
Sat 17 Jan 2026 02:02:13 INFO  [Epoch 13] Val Result: {'recall@5': 0.030654542801620936, 'ndcg@5': 0.01977682401852998, 'recall@10': 0.04865463565397905, 'ndcg@10': 0.02555133841020467}
